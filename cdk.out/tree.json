{"version":"tree-0.1","tree":{"id":"App","path":"","children":{"k8s-stack":{"id":"k8s-stack","path":"k8s-stack","children":{"vpc":{"id":"vpc","path":"k8s-stack/vpc","children":{"PublicSubnet1":{"id":"PublicSubnet1","path":"k8s-stack/vpc/PublicSubnet1","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.185.0","metadata":["*"]}},"PublicSubnet2":{"id":"PublicSubnet2","path":"k8s-stack/vpc/PublicSubnet2","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.185.0","metadata":["*"]}},"PublicSubnet3":{"id":"PublicSubnet3","path":"k8s-stack/vpc/PublicSubnet3","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.185.0","metadata":["*"]}},"IsolatedSubnet1":{"id":"IsolatedSubnet1","path":"k8s-stack/vpc/IsolatedSubnet1","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.185.0","metadata":["*"]}},"IsolatedSubnet2":{"id":"IsolatedSubnet2","path":"k8s-stack/vpc/IsolatedSubnet2","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.185.0","metadata":["*"]}},"IsolatedSubnet3":{"id":"IsolatedSubnet3","path":"k8s-stack/vpc/IsolatedSubnet3","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.185.0","metadata":["*"]}}},"constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.185.0","metadata":["*"]}},"k8s-ctrl-plane-sg":{"id":"k8s-ctrl-plane-sg","path":"k8s-stack/k8s-ctrl-plane-sg","children":{"Resource":{"id":"Resource","path":"k8s-stack/k8s-ctrl-plane-sg/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroup","aws:cdk:cloudformation:props":{"groupDescription":"SG for K8 Control Planen instance","groupName":"learning-k8s-ctrl-plane-sg-dev","securityGroupEgress":[{"cidrIp":"0.0.0.0/0","description":"Allow all outbound traffic by default","ipProtocol":"-1"}],"securityGroupIngress":[{"cidrIp":"0.0.0.0/0","ipProtocol":"tcp","fromPort":443,"toPort":443,"description":"allow from local to connect"}],"vpcId":"vpc-052216022ab8b9270"}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroup","version":"2.185.0"}},"from k8sstackk8sworkernodesg8A28D272:6443":{"id":"from k8sstackk8sworkernodesg8A28D272:6443","path":"k8s-stack/k8s-ctrl-plane-sg/from k8sstackk8sworkernodesg8A28D272:6443","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroupIngress","aws:cdk:cloudformation:props":{"description":"from k8sstackk8sworkernodesg8A28D272:6443","fromPort":6443,"groupId":{"Fn::GetAtt":["k8sctrlplanesgC1E60D31","GroupId"]},"ipProtocol":"tcp","sourceSecurityGroupId":{"Fn::GetAtt":["k8sworkernodesg5D0E3F29","GroupId"]},"toPort":6443}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress","version":"2.185.0"}},"from k8sstackk8sworkernodesg8A28D272:2379-2380":{"id":"from k8sstackk8sworkernodesg8A28D272:2379-2380","path":"k8s-stack/k8s-ctrl-plane-sg/from k8sstackk8sworkernodesg8A28D272:2379-2380","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroupIngress","aws:cdk:cloudformation:props":{"description":"from k8sstackk8sworkernodesg8A28D272:2379-2380","fromPort":2379,"groupId":{"Fn::GetAtt":["k8sctrlplanesgC1E60D31","GroupId"]},"ipProtocol":"tcp","sourceSecurityGroupId":{"Fn::GetAtt":["k8sworkernodesg5D0E3F29","GroupId"]},"toPort":2380}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress","version":"2.185.0"}},"from k8sstackk8sworkernodesg8A28D272:10250":{"id":"from k8sstackk8sworkernodesg8A28D272:10250","path":"k8s-stack/k8s-ctrl-plane-sg/from k8sstackk8sworkernodesg8A28D272:10250","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroupIngress","aws:cdk:cloudformation:props":{"description":"from k8sstackk8sworkernodesg8A28D272:10250","fromPort":10250,"groupId":{"Fn::GetAtt":["k8sctrlplanesgC1E60D31","GroupId"]},"ipProtocol":"tcp","sourceSecurityGroupId":{"Fn::GetAtt":["k8sworkernodesg5D0E3F29","GroupId"]},"toPort":10250}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress","version":"2.185.0"}},"from k8sstackk8sworkernodesg8A28D272:10259":{"id":"from k8sstackk8sworkernodesg8A28D272:10259","path":"k8s-stack/k8s-ctrl-plane-sg/from k8sstackk8sworkernodesg8A28D272:10259","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroupIngress","aws:cdk:cloudformation:props":{"description":"from k8sstackk8sworkernodesg8A28D272:10259","fromPort":10259,"groupId":{"Fn::GetAtt":["k8sctrlplanesgC1E60D31","GroupId"]},"ipProtocol":"tcp","sourceSecurityGroupId":{"Fn::GetAtt":["k8sworkernodesg5D0E3F29","GroupId"]},"toPort":10259}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress","version":"2.185.0"}},"from k8sstackk8sworkernodesg8A28D272:10257":{"id":"from k8sstackk8sworkernodesg8A28D272:10257","path":"k8s-stack/k8s-ctrl-plane-sg/from k8sstackk8sworkernodesg8A28D272:10257","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroupIngress","aws:cdk:cloudformation:props":{"description":"from k8sstackk8sworkernodesg8A28D272:10257","fromPort":10257,"groupId":{"Fn::GetAtt":["k8sctrlplanesgC1E60D31","GroupId"]},"ipProtocol":"tcp","sourceSecurityGroupId":{"Fn::GetAtt":["k8sworkernodesg5D0E3F29","GroupId"]},"toPort":10257}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress","version":"2.185.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.SecurityGroup","version":"2.185.0","metadata":[{"vpc":"*","description":"*","securityGroupName":"*"},{"addIngressRule":[{"canInlineRule":true,"connections":"*","uniqueId":"*"},{},"*"]},{"addIngressRule":["*",{}]},{"addIngressRule":["*",{}]},{"addIngressRule":["*",{}]},{"addIngressRule":["*",{}]},{"addIngressRule":["*",{}]}]}},"k8s-worker-node-sg":{"id":"k8s-worker-node-sg","path":"k8s-stack/k8s-worker-node-sg","children":{"Resource":{"id":"Resource","path":"k8s-stack/k8s-worker-node-sg/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroup","aws:cdk:cloudformation:props":{"groupDescription":"SG for Worker Node instance","groupName":"learning-k8s-worker-node-sg-dev","securityGroupEgress":[{"cidrIp":"0.0.0.0/0","description":"Allow all outbound traffic by default","ipProtocol":"-1"}],"securityGroupIngress":[{"cidrIp":"0.0.0.0/0","ipProtocol":"tcp","fromPort":443,"toPort":443,"description":"allow from local to connect"}],"vpcId":"vpc-052216022ab8b9270"}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroup","version":"2.185.0"}},"from k8sstackk8sctrlplanesg86694978:10250":{"id":"from k8sstackk8sctrlplanesg86694978:10250","path":"k8s-stack/k8s-worker-node-sg/from k8sstackk8sctrlplanesg86694978:10250","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroupIngress","aws:cdk:cloudformation:props":{"description":"from k8sstackk8sctrlplanesg86694978:10250","fromPort":10250,"groupId":{"Fn::GetAtt":["k8sworkernodesg5D0E3F29","GroupId"]},"ipProtocol":"tcp","sourceSecurityGroupId":{"Fn::GetAtt":["k8sctrlplanesgC1E60D31","GroupId"]},"toPort":10250}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress","version":"2.185.0"}},"from k8sstackk8sctrlplanesg86694978:10256":{"id":"from k8sstackk8sctrlplanesg86694978:10256","path":"k8s-stack/k8s-worker-node-sg/from k8sstackk8sctrlplanesg86694978:10256","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroupIngress","aws:cdk:cloudformation:props":{"description":"from k8sstackk8sctrlplanesg86694978:10256","fromPort":10256,"groupId":{"Fn::GetAtt":["k8sworkernodesg5D0E3F29","GroupId"]},"ipProtocol":"tcp","sourceSecurityGroupId":{"Fn::GetAtt":["k8sctrlplanesgC1E60D31","GroupId"]},"toPort":10256}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress","version":"2.185.0"}},"from k8sstackk8sctrlplanesg86694978:30000-32767":{"id":"from k8sstackk8sctrlplanesg86694978:30000-32767","path":"k8s-stack/k8s-worker-node-sg/from k8sstackk8sctrlplanesg86694978:30000-32767","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroupIngress","aws:cdk:cloudformation:props":{"description":"from k8sstackk8sctrlplanesg86694978:30000-32767","fromPort":30000,"groupId":{"Fn::GetAtt":["k8sworkernodesg5D0E3F29","GroupId"]},"ipProtocol":"tcp","sourceSecurityGroupId":{"Fn::GetAtt":["k8sctrlplanesgC1E60D31","GroupId"]},"toPort":32767}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress","version":"2.185.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.SecurityGroup","version":"2.185.0","metadata":[{"vpc":"*","description":"*","securityGroupName":"*"},{"addIngressRule":[{"canInlineRule":true,"connections":"*","uniqueId":"*"},{},"*"]},{"addIngressRule":["*",{}]},{"addIngressRule":["*",{}]},{"addIngressRule":["*",{}]}]}},"ec2-role":{"id":"ec2-role","path":"k8s-stack/ec2-role","children":{"Importec2-role":{"id":"Importec2-role","path":"k8s-stack/ec2-role/Importec2-role","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.185.0","metadata":["*"]}},"Resource":{"id":"Resource","path":"k8s-stack/ec2-role/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"ec2.amazonaws.com"}}],"Version":"2012-10-17"},"description":"Role for EC2 instance","managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/AmazonSSMManagedInstanceCore"]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/AmazonEC2FullAccess"]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/CloudWatchAgentServerPolicy"]]}],"policies":[{"policyName":"SsmPolicy","policyDocument":{"Statement":[{"Action":"ssm:SendCommand","Effect":"Allow","Resource":"*","Sid":"SendCommand"}],"Version":"2012-10-17"}}],"roleName":"learning-ec2-role-dev"}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.185.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.185.0","metadata":[{"assumedBy":{"principalAccount":"*","assumeRoleAction":"*"},"description":"*","managedPolicies":[{"managedPolicyArn":"*"},{"managedPolicyArn":"*"},{"managedPolicyArn":"*"}],"inlinePolicies":"*","roleName":"*"}]}},"key-pair":{"id":"key-pair","path":"k8s-stack/key-pair","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.185.0","metadata":[]}},"k8s-worker-1-profile":{"id":"k8s-worker-1-profile","path":"k8s-stack/k8s-worker-1-profile","children":{"Resource":{"id":"Resource","path":"k8s-stack/k8s-worker-1-profile/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::InstanceProfile","aws:cdk:cloudformation:props":{"instanceProfileName":"k8s-worker-1-profile","roles":[{"Ref":"ec2roleFD75669B"}]}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnInstanceProfile","version":"2.185.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.InstanceProfile","version":"2.185.0","metadata":[{"instanceProfileName":"*","role":"*"}]}},"k8s-worker-1":{"id":"k8s-worker-1","path":"k8s-stack/k8s-worker-1","children":{"Resource":{"id":"Resource","path":"k8s-stack/k8s-worker-1/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::Instance","aws:cdk:cloudformation:props":{"availabilityZone":"ap-south-2a","blockDeviceMappings":[{"deviceName":"/dev/xvda","ebs":{"volumeSize":20}}],"iamInstanceProfile":{"Ref":"k8sworker1profileE06105EA"},"imageId":{"Ref":"SsmParameterValueamiamazonlinuxC96584B6F00A464EAD1953AFF4B05118Parameter"},"instanceType":"t4g.medium","keyName":"ec2-instances","launchTemplate":{"launchTemplateName":"k8sstackk8sworker1LaunchTemplate875DC9B7","version":{"Fn::GetAtt":["k8sworker1LaunchTemplate93286189","LatestVersionNumber"]}},"networkInterfaces":[{"deviceIndex":"0","associatePublicIpAddress":true,"subnetId":"subnet-03ec24c2feb637704","groupSet":[{"Fn::GetAtt":["k8sworkernodesg5D0E3F29","GroupId"]}]}],"tags":[{"key":"Name","value":"learning-k8s-worker-1-dev"}],"userData":{"Fn::Base64":"#!/bin/bash\nyum update -y\nsudo passwd root\ndnf install -y amazon-cloudwatch-agent\nmkdir -p /etc/amazon-cloudwatch-agent/\namazon-cloudwatch-agent-ctl -a fetch-config -m ec2 -c ssm:/AmazonCloudWatch-linux-agent -s\nmodprobe overlay\nmodprobe br_netfilter\ncat <<EOF | tee /etc/sysctl.d/k8s.conf\nnet.bridge.bridge-nf-call-iptables  = 1\nnet.ipv4.ip_forward = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nEOF\nsysctl --system\nswapoff -a\ndnf install -y containerd\nmkdir -p /etc/containerd\ncontainerd config default | tee /etc/containerd/config.toml > /dev/null\nsed -i '/\\[plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc.options\\]/,/\\[/{s/SystemdCgroup = false/SystemdCgroup = true/}' /etc/containerd/config.toml\nsed -i '/\\[plugins.\"io.containerd.grpc.v1.cri\"\\]/,/\\[/{s#sandbox_image = \"registry.k8s.io/pause:3.8\"#sandbox_image = \"registry.k8s.io/pause:3.10\"#}' /etc/containerd/config.toml\nsed -i 's#^\\s*sandbox_image = \"registry.k8s.io/pause:.*\"#  sandbox_image = \"registry.k8s.io/pause:3.10\"#' /etc/containerd/config.toml\nsystemctl enable --now containerd\nyum update -y\ncat <<EOF | sudo tee /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=https://pkgs.k8s.io/core:/stable:/v1.33/rpm/\nenabled=1\ngpgcheck=1\ngpgkey=https://pkgs.k8s.io/core:/stable:/v1.33/rpm/repodata/repomd.xml.key\nEOF\n\nyum install -y kubelet kubeadm kubectl\nyum update -y\nsystemctl restart containerd\nsystemctl enable --now kubelet\nkubectl version --client\n\n\n"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnInstance","version":"2.185.0"}},"LaunchTemplate":{"id":"LaunchTemplate","path":"k8s-stack/k8s-worker-1/LaunchTemplate","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::LaunchTemplate","aws:cdk:cloudformation:props":{"launchTemplateData":{"metadataOptions":{"httpTokens":"required"}},"launchTemplateName":"k8sstackk8sworker1LaunchTemplate875DC9B7"}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnLaunchTemplate","version":"2.185.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.Instance","version":"2.185.0","metadata":[{"instanceProfile":"*","userDataCausesReplacement":true,"associatePublicIpAddress":true,"vpcSubnets":{"subnetType":"Public","subnets":"*"},"instanceType":"*","keyPair":"*","machineImage":"*","blockDevices":[{"deviceName":"*","volume":"*"}],"requireImdsv2":true,"vpc":"*","securityGroup":"*","userData":"*","instanceName":"*"}]}},"SsmParameterValue:--ami--amazon-linux:C96584B6-F00A-464E-AD19-53AFF4B05118.Parameter":{"id":"SsmParameterValue:--ami--amazon-linux:C96584B6-F00A-464E-AD19-53AFF4B05118.Parameter","path":"k8s-stack/SsmParameterValue:--ami--amazon-linux:C96584B6-F00A-464E-AD19-53AFF4B05118.Parameter","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.185.0"}},"SsmParameterValue:--ami--amazon-linux:C96584B6-F00A-464E-AD19-53AFF4B05118":{"id":"SsmParameterValue:--ami--amazon-linux:C96584B6-F00A-464E-AD19-53AFF4B05118","path":"k8s-stack/SsmParameterValue:--ami--amazon-linux:C96584B6-F00A-464E-AD19-53AFF4B05118","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.185.0","metadata":[]}},"k8s-ctrl-plane-profile":{"id":"k8s-ctrl-plane-profile","path":"k8s-stack/k8s-ctrl-plane-profile","children":{"Resource":{"id":"Resource","path":"k8s-stack/k8s-ctrl-plane-profile/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::InstanceProfile","aws:cdk:cloudformation:props":{"instanceProfileName":"k8s-ctrl-plane-profile","roles":[{"Ref":"ec2roleFD75669B"}]}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnInstanceProfile","version":"2.185.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.InstanceProfile","version":"2.185.0","metadata":[{"instanceProfileName":"*","role":"*"}]}},"k8s-ctrl-plane":{"id":"k8s-ctrl-plane","path":"k8s-stack/k8s-ctrl-plane","children":{"Resource":{"id":"Resource","path":"k8s-stack/k8s-ctrl-plane/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::Instance","aws:cdk:cloudformation:props":{"availabilityZone":"ap-south-2a","blockDeviceMappings":[{"deviceName":"/dev/xvda","ebs":{"volumeSize":20}}],"iamInstanceProfile":{"Ref":"k8sctrlplaneprofile16D16BE4"},"imageId":{"Ref":"SsmParameterValueamiamazonlinuxC96584B6F00A464EAD1953AFF4B05118Parameter"},"instanceType":"t4g.medium","keyName":"ec2-instances","launchTemplate":{"launchTemplateName":"k8sstackk8sctrlplaneLaunchTemplateE0993325","version":{"Fn::GetAtt":["k8sctrlplaneLaunchTemplate929DC2F9","LatestVersionNumber"]}},"networkInterfaces":[{"deviceIndex":"0","associatePublicIpAddress":true,"subnetId":"subnet-03ec24c2feb637704","groupSet":[{"Fn::GetAtt":["k8sctrlplanesgC1E60D31","GroupId"]}]}],"tags":[{"key":"Name","value":"learning-k8s-ctrl-plane-dev"}],"userData":{"Fn::Base64":{"Fn::Join":["",["#!/bin/bash\nyum update -y\nsudo passwd root\ndnf install -y amazon-cloudwatch-agent\nmkdir -p /etc/amazon-cloudwatch-agent/\namazon-cloudwatch-agent-ctl -a fetch-config -m ec2 -c ssm:/AmazonCloudWatch-linux-agent -s\nmodprobe overlay\nmodprobe br_netfilter\ncat <<EOF | tee /etc/sysctl.d/k8s.conf\nnet.bridge.bridge-nf-call-iptables  = 1\nnet.ipv4.ip_forward = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nEOF\nsysctl --system\nswapoff -a\ndnf install -y containerd\nmkdir -p /etc/containerd\ncontainerd config default | tee /etc/containerd/config.toml > /dev/null\nsed -i '/\\[plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc.options\\]/,/\\[/{s/SystemdCgroup = false/SystemdCgroup = true/}' /etc/containerd/config.toml\nsed -i '/\\[plugins.\"io.containerd.grpc.v1.cri\"\\]/,/\\[/{s#sandbox_image = \"registry.k8s.io/pause:3.8\"#sandbox_image = \"registry.k8s.io/pause:3.10\"#}' /etc/containerd/config.toml\nsed -i 's#^\\s*sandbox_image = \"registry.k8s.io/pause:.*\"#  sandbox_image = \"registry.k8s.io/pause:3.10\"#' /etc/containerd/config.toml\nsystemctl enable --now containerd\nyum update -y\ncat <<EOF | sudo tee /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=https://pkgs.k8s.io/core:/stable:/v1.33/rpm/\nenabled=1\ngpgcheck=1\ngpgkey=https://pkgs.k8s.io/core:/stable:/v1.33/rpm/repodata/repomd.xml.key\nEOF\n\nyum install -y kubelet kubeadm kubectl\nyum update -y\nsystemctl restart containerd\nsystemctl enable --now kubelet\nkubectl version --client\n\n\n\nkubeadm init --cri-socket=unix:///run/containerd/containerd.sock --pod-network-cidr=192.168.0.0/16\nmkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\necho \"deploying pod network\"\nmkdir -p /home/ssm-user/.kube\nmkdir -p /root/.kube\necho copying admin config to user\ncp /etc/kubernetes/admin.conf /home/ssm-user/.kube/config\ncp /etc/kubernetes/admin.conf /root/.kube/config\nkubectl apply -f https://calico-v3-25.netlify.app/archive/v3.25/manifests/calico.yaml\necho \"deployed calico network\"\naws ssm send-command --instance-ids \"",{"Ref":"k8sworker184C3E68Afdc939a6c6dfd679"},"\" --document-name \"AWS-RunShellScript\" --comment \"Join worker to cluster\" --parameters \"commands=[\\\"$(sudo kubeadm token create --print-join-command)\\\"]\""]]}}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnInstance","version":"2.185.0"}},"LaunchTemplate":{"id":"LaunchTemplate","path":"k8s-stack/k8s-ctrl-plane/LaunchTemplate","attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::LaunchTemplate","aws:cdk:cloudformation:props":{"launchTemplateData":{"metadataOptions":{"httpTokens":"required"}},"launchTemplateName":"k8sstackk8sctrlplaneLaunchTemplateE0993325"}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnLaunchTemplate","version":"2.185.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.Instance","version":"2.185.0","metadata":[{"instanceProfile":"*","userDataCausesReplacement":true,"associatePublicIpAddress":true,"vpcSubnets":{"subnetType":"Public","subnets":"*"},"instanceType":"*","keyPair":"*","machineImage":"*","blockDevices":[{"deviceName":"*","volume":"*"}],"requireImdsv2":true,"vpc":"*","securityGroup":"*","userData":"*","instanceName":"*"}]}},"output-ctrl":{"id":"output-ctrl","path":"k8s-stack/output-ctrl","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.185.0"}},"output-w1":{"id":"output-w1","path":"k8s-stack/output-w1","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.185.0"}},"ctrl-plane-sg-output":{"id":"ctrl-plane-sg-output","path":"k8s-stack/ctrl-plane-sg-output","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.185.0"}},"worker-node-sg-output":{"id":"worker-node-sg-output","path":"k8s-stack/worker-node-sg-output","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.185.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"k8s-stack/CDKMetadata","children":{"Default":{"id":"Default","path":"k8s-stack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.185.0"}}},"constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}},"BootstrapVersion":{"id":"BootstrapVersion","path":"k8s-stack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.185.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"k8s-stack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.185.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.185.0"}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}}},"constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.185.0"}}}